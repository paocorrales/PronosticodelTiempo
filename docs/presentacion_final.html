<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Validación de pronósticos</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pao Corrales" />
    <meta name="date" content="2020-10-19" />
    <link href="site_libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="site_libs/remark-css-0.0.1/rladies.css" rel="stylesheet" />
    <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/weather-icons.min.css" type="text/css" />
    <link rel="stylesheet" href="css/weather-icons.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Validación de pronósticos
## <i class='wi wi-day-sunny'></i>
### Pao Corrales
### Pronóstico del Tiempo
### 2020-10-19

---




class: inverse, center, middle

# Ciudad 1: Buenos Aires

---

## Temperatura

.pull-left[

![](presentacion_final_files/figure-html/unnamed-chunk-1-1.png)&lt;!-- --&gt;
]

--
.pull-right[

&lt;table class="table table-responsive" style="font-size: 14px; width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Validez &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; BIAS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; MAE &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; RMSE &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Correlación &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;vertical-align: middle !important;" rowspan="2"&gt; Temperatura máxima &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -0.87 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.35 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.45 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   
   &lt;td style="text-align:left;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -1.45 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.53 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.21 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.96 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;vertical-align: middle !important;" rowspan="2"&gt; Temperatura mínima &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -0.77 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.26 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.83 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   
   &lt;td style="text-align:left;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:center;color: red !important;"&gt; 1.07 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.57 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.57 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.89 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

???

En esta figura les muestro la evolución de la temperatura pronosticada en linea llena y la temperatura observada en linea punteada. Hay que tener presente que no tenemos pronósticos para todos los días. Las columnas corresponden a los plazos de pronóstico y las filas a la temperatura máxima o mínima.

Y en lineas generales los pronósticos son acordes a la evolución de la temperatura. Sin embargo y principalmente para la temperatura mínima se ven diferencias importantes.

Esto se puede ver cuantitativamente en la siguiente tabla donde se ve que el RMSE del pronóstico para la temperatura temperatura mínima es mayor tanto para 24 como 48 horas. En casi todos los casos el pronóstico tienen un bias negativo, está subestimando la temperatura. Esto cambia para la mínima a 48 horas donde el bias es positivo, cálido, indicand que el pronóstico está sobreestimando la mínima. Esto puede deberse tanto al aumento del plazo del pronóstico y por lo tanto de los errores de los modelos como a un aumento de la incertidumbre en el análisis de la situación.

---

.pull-left[

![](presentacion_final_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;
]

.pull-right[

![](presentacion_final_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;
]

???

En la figura de la izquierda se muestra la relación entre la temperatura observada y la pronósticada, en naranja a 24 horas y en verde a 48 horas. 

Para el caso de la máxima, en general hay algún casos donde la temperatura fue subestimada como vimos con los valores de bias negativos, pero en general tienen mucha menos dispersión. Por otro lado la temperatura mínima y sobre todo a 48 horas muestra mayor dispersión con varios casos de sobreestimación de la temperatura.

---

.pull-left[

### Algunos casos

![](presentacion_final_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;
]

.pull-right[

**Pronóstico de mínima a 24 horas**

- Un caso el 22 de septiembre. Temperatura pronósticada 6°C, observada 10°C

*Luego del pasaje de un frente frío esperaba una disminución más marcada de la teperatura y poca o nada nubosidad*

**Pronóstico de mínima a 48 horas**

Dos casos.

- 12 de septiembre. Temperatura pronósticada 10°C, observada 6.4°C
- 16 de septiembre. Temperatura pronósticada 10°C, observada 7.2°C

*Sobreestimación del modelo y frente frío*
]

???

En el caso de la temperatura mínima a 24, el caso corresponde al 22 de Septiembre (y no voy a culpar al día de la primavera). Luego del  paso de un frente frío en el día/días previos e inmersos en un anticliclón postfrontal esperaba una disminución mucho más marcada de la temperatura favorecida también por la ausencia de nubes y viento. Sin embargo se observaron cirros y viento sueves a leves del sector norte lo que moderaron la temperatura mínima durante la noche. 

Los casos de temperatura minima a 48 horas correspondes ambos a una sobreestimación de la temperatura. Esto se debe en parte a que tanto el GFS como el WRF sobreestiman la temperatura mínima (al menos en las ciudades donde pronostiqué) y me llevó un tiempo ajustar eso (a veces de más como en el caso anterior). Pero además por ejemplo el caso de 12 de septiembre corresponde al día posterior del pasaje de un frente frío y que si bien tuve en cuenta, no lo suficiente.

---

## Precipitación

.pull-left[

### Tabla de contingencia


|    &amp;nbsp;    | Obs No | Obs Sí |
|:------------:|:------:|:------:|
| **Prono No** |   18   |   0    |
| **Prono Sí** |   1    |   2    |

]

.pull-right[

### Estadísticos

- Tasa de acierto: 0.95
- BIAS: 1.5
- POD: 1
- FAR: 0.33
- TS: 0.67

]

???

Respecto de la precipitción, no hubo muchas situaciones a pronosticar, en total pronóstiqué lluviar en 3 días diferentes, de los cuales llovió 2 dando una tasa de acierto de 0.95 y falsa alarma del 33%. 

El caso de falsa alarma corresponde al primer episodio de lluvia cuando todavía no estabamos utilizando los pronósticos por ensambles. Me guie por un solo modelo (GFS) y no estuve en la discusión donde seguramente analizaron cosas que no tuve en cuenta.

---

class: inverse, center, middle

# Ciudad 2: Salta

---

## Temperatura

.pull-left[

![](presentacion_final_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;
]

--
.pull-right[

&lt;table class="table table-responsive" style="font-size: 14px; width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Validez &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; BIAS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; MAE &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; RMSE &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Correlación &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;vertical-align: middle !important;" rowspan="2"&gt; Temperatura máxima &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -0.05 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.51 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.85 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.87 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   
   &lt;td style="text-align:left;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -0.86 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.08 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.53 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.89 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;vertical-align: middle !important;" rowspan="2"&gt; Temperatura mínima &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:center;color: red !important;"&gt; 0.40 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.70 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.34 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.66 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   
   &lt;td style="text-align:left;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:center;color: red !important;"&gt; 0.81 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.19 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.82 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.65 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

???

En el caso de Salta, de nuevo la evolución de la temperatura máxima pronosticada respecto de a observada es bastante razonable y por ejemplo el bias para la t maxima a 24 horas es de solo -0.05. 

Algo muy distinto ocurre con la mínima donde los errores aumentan y de hecho la correlación es mucho menor, de alrededor de 0.6 para ambos plazos. La temperatura minima fue particularmente completa de pronosticar en parte porque los modelos no la representan bien y por cuestiones locales.

---

.pull-left[

![](presentacion_final_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;
]

.pull-right[

![](presentacion_final_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;
]

???

En estos graficos de dispersión para la teperatura máxima se ve poca dispersión (la correlación es de 0.89 y 0.87) aunque algo mayor que para Buenos Aires. Ahora, respecto de la mínima... la dispersión es enorme y sería dificil elegir uno o dos casos. 

Se ve en el grafico de la derecha que los casos (pocos pronosticos) estan distribuidos en todo el rango de diferencias. 
---

## Precipitación

.pull-left[

### Tabla de contingencia


|    &amp;nbsp;    | Obs No | Obs Sí |
|:------------:|:------:|:------:|
| **Prono No** |   18   |   0    |
| **Prono Sí** |   2    |   0    |

]

.pull-right[

### Estadísticos

- Tasa de acierto: 0.9
&lt;!-- - BIAS: \infty{} --&gt;
&lt;!-- - POD: NA NaN --&gt;
- BIAS: NA
- POD: NA
- FAR: 1
- TS: 0

]

???

Y acá se muestra la tabla de contigencia para los pronósticos de precipitación. Fueron pocos casos y en hecho de no haber tenido ningún acierto ni falsa alarma hace imposible calcular el BIAS y la probabilidad de detección. En el caso de las Falsas alarmas, es 1, ya que los únicos casos donde se pronosticó precipitación (2 días seguidos) no llovió. 

---

### Algunos casos o ¿todos?

* **Temperatura mínima:** fue todo un desafío sin importar el plazo. Todos los modelos tienden a sobrestimar la temperatura y entender los patrones de nubosidad fue complejo.

* **Precipitación:** pocos eventos como para sacar conclusiones, pero... En todos los casos donde los modelos pronosticaron precipitación se sumaron vientos del Este intensos. Si bien se generó precipitación en la región en algunos de estos casos, nunca ocurrieron específicamente en Salta.

---

class: inverse, center, middle

# Ciudad 3: Córdoba

---

## Temperatura

.pull-left[

![](presentacion_final_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;
]

--
.pull-right[

&lt;table class="table table-responsive" style="font-size: 14px; width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Validez &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; BIAS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; MAE &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; RMSE &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Correlación &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;vertical-align: middle !important;" rowspan="2"&gt; Temperatura máxima &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -1.53 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.80 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.43 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.96 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   
   &lt;td style="text-align:left;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:center;color: blue !important;"&gt; -1.73 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.70 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.24 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;vertical-align: middle !important;" rowspan="2"&gt; Temperatura mínima &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:center;color: red !important;"&gt; 1.47 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.17 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.80 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.58 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   
   &lt;td style="text-align:left;"&gt; 48 &lt;/td&gt;
   &lt;td style="text-align:center;color: red !important;"&gt; 1.58 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.35 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.67 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.76 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

---

.pull-left[

![](presentacion_final_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;
]

.pull-right[

![](presentacion_final_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;
]



---

## Precipitación

.pull-left[

### Tabla de contingencia


|    &amp;nbsp;    | Obs No | Obs Sí |
|:------------:|:------:|:------:|
| **Prono No** |   10   |   0    |
| **Prono Sí** |   1    |   1    |

]

.pull-right[

### Estadísticos

- Tasa de acierto: 0.92
- BIAS: 2
- POD: 1
- FAR: 0.5
- TS: 0.5

]

---

class: inverse, center, middle

![](img/tormentas.png)

# Fin
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
